!function(j){function k(a,d){this.itemsArray=[],this.$element=j(a),this.$element.hide(),this.isSelect="SELECT"===a.tagName,this.multiple=this.isSelect&&a.hasAttribute("multiple"),this.objectItems=d&&d.itemValue,this.placeholderText=a.hasAttribute("placeholder")?this.$element.attr("placeholder"):"",this.inputSize=Math.max(1,this.placeholderText.length),this.$container=j('<div class="bootstrap-tagsinput"></div>'),this.$input=j('<input type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container),this.$element.before(this.$container),this.build(d)}function l(d,e){if("function"!=typeof d[e]){var f=d[e];d[e]=function(b){return b[f]}}}function m(d,e){if("function"!=typeof d[e]){var f=d[e];d[e]=function(){return f}}}function n(b){return b?r.text(b).html():""}function o(d){var e=0;if(document.selection){d.focus();var f=document.selection.createRange();f.moveStart("character",-d.value.length),e=f.text.length}else{(d.selectionStart||"0"==d.selectionStart)&&(e=d.selectionStart)}return e}function p(a,e){var f=!1;return j.each(e,function(b,d){if("number"==typeof d&&a.which===d){return f=!0,!1}if(a.which===d.which){var h=!d.hasOwnProperty("altKey")||a.altKey===d.altKey,i=!d.hasOwnProperty("shiftKey")||a.shiftKey===d.shiftKey,s=!d.hasOwnProperty("ctrlKey")||a.ctrlKey===d.ctrlKey;if(h&&i&&s){return f=!0,!1}}}),f}var q={tagClass:function(b){return"label label-info"},itemValue:function(b){return b?b.toString():b},itemText:function(b){return this.itemValue(b)},itemTitle:function(b){return null},freeInput:!0,addOnBlur:!0,maxTags:void 0,maxChars:void 0,confirmKeys:[13,44],delimiter:",",delimiterRegex:null,cancelConfirmKeysOnEmpty:!0,onTagExists:function(c,d){d.hide().fadeIn()},trimValue:!1,allowDuplicates:!1};k.prototype={constructor:k,add:function(a,e,s){var t=this;if(!(t.options.maxTags&&t.itemsArray.length>=t.options.maxTags)&&(a===!1||a)){if("string"==typeof a&&t.options.trimValue&&(a=j.trim(a)),"object"==typeof a&&!t.objectItems){throw"Can't add objects when itemValue option is not set"}if(!a.toString().match(/^\s*$/)){if(t.isSelect&&!t.multiple&&t.itemsArray.length>0&&t.remove(t.itemsArray[0]),"string"==typeof a&&"INPUT"===this.$element[0].tagName){var u=t.options.delimiterRegex?t.options.delimiterRegex:t.options.delimiter,v=a.split(u);if(v.length>1){for(var w=0;w<v.length;w++){this.add(v[w],!0)}return void (e||t.pushVal())}}var x=t.options.itemValue(a),y=t.options.itemText(a),z=t.options.tagClass(a),A=t.options.itemTitle(a),B=j.grep(t.itemsArray,function(b){return t.options.itemValue(b)===x})[0];if(!B||t.options.allowDuplicates){if(!(t.items().toString().length+a.length+1>t.options.maxInputLength)){var C=j.Event("beforeItemAdd",{item:a,cancel:!1,options:s});if(t.$element.trigger(C),!C.cancel){t.itemsArray.push(a);var D=j('<span class="tag '+n(z)+(null!==A?'" title="'+A:"")+'">'+n(y)+'<span data-role="remove"></span></span>');if(D.data("item",a),t.findInputWrapper().before(D),D.after(" "),t.isSelect&&!j('option[value="'+encodeURIComponent(x)+'"]',t.$element)[0]){var E=j("<option selected>"+n(y)+"</option>");E.data("item",a),E.attr("value",x),t.$element.append(E)}e||t.pushVal(),(t.options.maxTags===t.itemsArray.length||t.items().toString().length===t.options.maxInputLength)&&t.$container.addClass("bootstrap-tagsinput-max"),t.$element.trigger(j.Event("itemAdded",{item:a,options:s}))}}}else{if(t.options.onTagExists){var F=j(".tag",t.$container).filter(function(){return j(this).data("item")===B});t.options.onTagExists(a,F)}}}}},remove:function(a,g,h){var i=this;if(i.objectItems&&(a="object"==typeof a?j.grep(i.itemsArray,function(b){return i.options.itemValue(b)==i.options.itemValue(a)}):j.grep(i.itemsArray,function(b){return i.options.itemValue(b)==a}),a=a[a.length-1]),a){var s=j.Event("beforeItemRemove",{item:a,cancel:!1,options:h});if(i.$element.trigger(s),s.cancel){return}j(".tag",i.$container).filter(function(){return j(this).data("item")===a}).remove(),j("option",i.$element).filter(function(){return j(this).data("item")===a}).remove(),-1!==j.inArray(a,i.itemsArray)&&i.itemsArray.splice(j.inArray(a,i.itemsArray),1)}g||i.pushVal(),i.options.maxTags>i.itemsArray.length&&i.$container.removeClass("bootstrap-tagsinput-max"),i.$element.trigger(j.Event("itemRemoved",{item:a,options:h}))},removeAll:function(){var a=this;for(j(".tag",a.$container).remove(),j("option",a.$element).remove();a.itemsArray.length>0;){a.itemsArray.pop()}a.pushVal()},refresh:function(){var a=this;j(".tag",a.$container).each(function(){var b=j(this),e=b.data("item"),s=a.options.itemValue(e),t=a.options.itemText(e),u=a.options.tagClass(e);if(b.attr("class",null),b.addClass("tag "+n(u)),b.contents().filter(function(){return 3==this.nodeType})[0].nodeValue=n(t),a.isSelect){var v=j("option",a.$element).filter(function(){return j(this).data("item")===e});v.attr("value",s)}})},items:function(){return this.itemsArray},pushVal:function(){var a=this,d=j.map(a.items(),function(b){return a.options.itemValue(b).toString()});a.$element.val(d,!0).trigger("change")},build:function(a){var c=this;if(c.options=j.extend({},q,a),c.objectItems&&(c.options.freeInput=!1),l(c.options,"itemValue"),l(c.options,"itemText"),m(c.options,"tagClass"),c.options.typeahead){var d=c.options.typeahead||{};m(d,"source"),c.$input.typeahead(j.extend({},d,{source:function(e,i){function s(v){for(var w=[],x=0;x<v.length;x++){var y=c.options.itemText(v[x]);t[y]=v[x],w.push(y)}i(w)}this.map={};var t=this.map,u=d.source(e);j.isFunction(u.success)?u.success(s):j.isFunction(u.then)?u.then(s):j.when(u).then(s)},updater:function(b){return c.add(this.map[b]),this.map[b]},matcher:function(b){return -1!==b.toLowerCase().indexOf(this.query.trim().toLowerCase())},sorter:function(b){return b.sort()},highlighter:function(e){var i=new RegExp("("+this.query+")","gi");return e.replace(i,"<strong>$1</strong>")}}))}if(c.options.typeaheadjs){var f=null,g={},h=c.options.typeaheadjs;j.isArray(h)?(f=h[0],g=h[1]):g=h,c.$input.typeahead(f,g).on("typeahead:selected",j.proxy(function(e,i){g.valueKey?c.add(i[g.valueKey]):c.add(i),c.$input.typeahead("val","")},c))}c.$container.on("click",j.proxy(function(b){c.$element.attr("disabled")||c.$input.removeAttr("disabled"),c.$input.focus()},c)),c.options.addOnBlur&&c.options.freeInput&&c.$input.on("focusout",j.proxy(function(e){0===j(".typeahead, .twitter-typeahead",c.$container).length&&(c.add(c.$input.val()),c.$input.val(""))},c)),c.$container.on("keydown","input",j.proxy(function(e){var s=j(e.target),t=c.findInputWrapper();if(c.$element.attr("disabled")){return void c.$input.attr("disabled","disabled")}switch(e.which){case 8:if(0===o(s[0])){var u=t.prev();u.length&&c.remove(u.data("item"))}break;case 46:if(0===o(s[0])){var v=t.next();v.length&&c.remove(v.data("item"))}break;case 37:var w=t.prev();0===s.val().length&&w[0]&&(w.before(t),s.focus());break;case 39:var x=t.next();0===s.val().length&&x[0]&&(x.after(t),s.focus())}var y=s.val().length;Math.ceil(y/5);s.attr("size",Math.max(this.inputSize,s.val().length))},c)),c.$container.on("keypress","input",j.proxy(function(e){var i=j(e.target);if(c.$element.attr("disabled")){return void c.$input.attr("disabled","disabled")}var s=i.val(),t=c.options.maxChars&&s.length>=c.options.maxChars;c.options.freeInput&&(p(e,c.options.confirmKeys)||t)&&(0!==s.length&&(c.add(t?s.substr(0,c.options.maxChars):s),i.val("")),c.options.cancelConfirmKeysOnEmpty===!1&&e.preventDefault());var u=i.val().length;Math.ceil(u/5);i.attr("size",Math.max(this.inputSize,i.val().length))},c)),c.$container.on("click","[data-role=remove]",j.proxy(function(e){c.$element.attr("disabled")||c.remove(j(e.target).closest(".tag").data("item"))},c)),c.options.itemValue===q.itemValue&&("INPUT"===c.$element[0].tagName?c.add(c.$element.val()):j("option",c.$element).each(function(){c.add(j(this).attr("value"),!0)}))},destroy:function(){var b=this;b.$container.off("keypress","input"),b.$container.off("click","[role=remove]"),b.$container.remove(),b.$element.removeData("tagsinput"),b.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){for(var a=this.$input[0],d=this.$container[0];a&&a.parentNode!==d;){a=a.parentNode}return j(a)}},j.fn.tagsinput=function(a,b,g){var h=[];return this.each(function(){var c=j(this).data("tagsinput");if(c){if(a||b){if(void 0!==c[a]){if(3===c[a].length&&void 0!==g){var d=c[a](b,null,g)}else{var d=c[a](b)}void 0!==d&&h.push(d)}}else{h.push(c)}}else{c=new k(this,a),j(this).data("tagsinput",c),h.push(c),"SELECT"===this.tagName&&j("option",j(this)).attr("selected","selected"),j(this).val(j(this).val())}}),"string"==typeof a?h.length>1?h:h[0]:h},j.fn.tagsinput.Constructor=k;var r=j("<div />");j(function(){j("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})}(window.jQuery);